# ============================================================
# ğŸ—ï¸ BASE IMAGE â€” Python 3.10 slim (leggera e stabile su Render)
# ============================================================
FROM python:3.10-slim

# ------------------------------------------------------------
# ğŸ§© Install system dependencies (FFmpeg + libsndfile)
# Librosa e soundfile ne hanno bisogno per analizzare lâ€™audio
# ------------------------------------------------------------
RUN apt-get update && apt-get install -y \
    ffmpeg \
    libsndfile1 \
 && rm -rf /var/lib/apt/lists/*

# ------------------------------------------------------------
# ğŸ“ Imposta directory di lavoro
# ------------------------------------------------------------
WORKDIR /app

# ------------------------------------------------------------
# ğŸ§  Copia file di progetto
# ------------------------------------------------------------
COPY . .

# ------------------------------------------------------------
# ğŸ“¦ Installa dipendenze
# ------------------------------------------------------------
RUN pip install --no-cache-dir -r requirements.txt

# ------------------------------------------------------------
# ğŸŒ Porta esposta (Render usa $PORT automaticamente)
# ------------------------------------------------------------
EXPOSE 8080

# ------------------------------------------------------------
# ğŸš€ Comando di avvio
# ------------------------------------------------------------
CMD ["uvicorn", "app:app", "--host", "0.0.0.0", "--port", "8080"]
